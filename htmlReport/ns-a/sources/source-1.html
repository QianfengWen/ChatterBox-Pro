


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=GBK"> 
  <title>Coverage Report > ChatRoomView</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">chattingSystem.frameworks_drivers.ui.views</a>
</div>

<h1>Coverage Summary for Class: ChatRoomView (chattingSystem.frameworks_drivers.ui.views)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ChatRoomView</td>
<td class="coverageStat">
  <span class="percent">
    40%
  </span>
  <span class="absValue">
    (2/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    96.9%
  </span>
  <span class="absValue">
    (94/97)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ChatRoomView$1</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    14.3%
  </span>
  <span class="absValue">
    (1/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ChatRoomView$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (8/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ChatRoomView$3</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    16.7%
  </span>
  <span class="absValue">
    (1/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ChatRoomView$4</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    76.9%
  </span>
  <span class="absValue">
    (10/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ChatRoomView$5</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    16.7%
  </span>
  <span class="absValue">
    (1/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ChatRoomView$6</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    64.7%
  </span>
  <span class="absValue">
    (11/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85%
  </span>
  <span class="absValue">
    (125/147)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package chattingSystem.frameworks_drivers.ui.views;
&nbsp;
&nbsp;import chattingSystem.interface_adapter.controllers.*;
&nbsp;import chattingSystem.interface_adapter.state.ChatRoomState;
&nbsp;import chattingSystem.interface_adapter.view_models.ChatRoomViewManagerModel;
&nbsp;import chattingSystem.interface_adapter.view_models.ChatRoomViewModel;
&nbsp;import chattingSystem.interface_adapter.view_models.LoginViewModel;
&nbsp;import chattingSystem.interface_adapter.view_models.ViewManagerModel;
&nbsp;
&nbsp;import javax.swing.*;
&nbsp;import java.awt.*;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.beans.PropertyChangeEvent;
&nbsp;import java.beans.PropertyChangeListener;
&nbsp;import java.io.IOException;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.util.List;
&nbsp;import java.util.Objects;
&nbsp;
&nbsp;public class ChatRoomView extends JPanel implements ActionListener, PropertyChangeListener {
&nbsp;
&nbsp;    public final String viewName;
&nbsp;    private final JButton getWeather;
&nbsp;    public final JButton send;
&nbsp;    private final JButton getJoke;
&nbsp;
&nbsp;    public final JButton logOut;
&nbsp;    private final JTextField messageInput;
&nbsp;    public ChatRoomViewModel chatRoomViewModel;
&nbsp;    public LogOutController logOutController;
&nbsp;    public ShowWeatherController showWeatherController;
&nbsp;    public ShowJokeController showJokeController;
&nbsp;
&nbsp;    public SendMessageController sendMessageController;
&nbsp;    public RefreshingMessageController refreshingMessageController;
&nbsp;
&nbsp;
&nbsp;    private final ChatRoomViewManagerModel chatRoomViewManagerModel;
&nbsp;
&nbsp;    public ChatRoomView(ChatRoomViewModel chatRoomViewModel,
&nbsp;                        ChatRoomViewManagerModel chatRoomViewManagerModel,
&nbsp;                        ChatRoomViewManager chatRoomViewManager,
&nbsp;                        LogOutController logOutController,
&nbsp;                        ShowWeatherController showWeatherController,
&nbsp;                        SendMessageController sendMessageController,
&nbsp;                        RefreshingMessageController refreshingMessageController,
<b class="fc">&nbsp;                        ShowJokeController showJokeController)    {</b>
<b class="fc">&nbsp;        this.viewName = chatRoomViewModel.getViewName();</b>
<b class="fc">&nbsp;        this.chatRoomViewModel = chatRoomViewModel;</b>
<b class="fc">&nbsp;        this.chatRoomViewManagerModel = chatRoomViewManagerModel;</b>
<b class="fc">&nbsp;        this.logOutController = logOutController;</b>
<b class="fc">&nbsp;        this.showWeatherController = showWeatherController;</b>
<b class="fc">&nbsp;        this.sendMessageController = sendMessageController;</b>
<b class="fc">&nbsp;        this.refreshingMessageController = refreshingMessageController;</b>
<b class="fc">&nbsp;        this.showJokeController = showJokeController;</b>
<b class="fc">&nbsp;        this.messageInput = new JTextField();</b>
<b class="fc">&nbsp;        chatRoomViewManager.addView(this, viewName);</b>
<b class="fc">&nbsp;        chatRoomViewModel.addPropertyChangeListener(this);</b>
&nbsp;
<b class="fc">&nbsp;        this.setSize(720, 960); // Explicitly set the size of the frame</b>
&nbsp;        // Initialize the view format, separate from other views
<b class="fc">&nbsp;        setLayout(new GridBagLayout());</b>
<b class="fc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="fc">&nbsp;        gbc.fill = GridBagConstraints.HORIZONTAL;</b>
&nbsp;
&nbsp;
&nbsp;        // Title
<b class="fc">&nbsp;        JLabel title = new JLabel(chatRoomViewModel.TITLE_LABEL, SwingConstants.CENTER);</b>
<b class="fc">&nbsp;        title.setFont(new Font(&quot;Arial&quot;, Font.BOLD, 24));</b>
<b class="fc">&nbsp;        title.setForeground(new Color(30, 144, 255));</b>
<b class="fc">&nbsp;        title.setBorder(BorderFactory.createLineBorder(Color.BLACK));</b>
<b class="fc">&nbsp;        title.setOpaque(true);</b>
<b class="fc">&nbsp;        title.setBackground(new Color(220, 220, 220));</b>
<b class="fc">&nbsp;        gbc.gridx = 0;</b>
<b class="fc">&nbsp;        gbc.gridy = 0;</b>
<b class="fc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER; // Span across all columns</b>
<b class="fc">&nbsp;        gbc.insets = new Insets(20, 10, 10, 10);</b>
<b class="fc">&nbsp;        add(title, gbc);</b>
&nbsp;
&nbsp;        // Message Label - Positioned at the top left
<b class="fc">&nbsp;        JLabel messageLabel = new JLabel(chatRoomViewModel.MESSAGE_LABEL);</b>
<b class="fc">&nbsp;        gbc.gridx = 0;</b>
<b class="fc">&nbsp;        gbc.gridy = 1; // Set to the row below the title</b>
<b class="fc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="fc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST; // Anchor to top-left</b>
<b class="fc">&nbsp;        gbc.insets = new Insets(10, 10, 5, 5);</b>
<b class="fc">&nbsp;        add(messageLabel, gbc);</b>
&nbsp;
&nbsp;        // Message Display
<b class="fc">&nbsp;        JTextArea messageDisplay = new JTextArea(20, 20);</b>
<b class="fc">&nbsp;        JScrollPane scrollPane = new JScrollPane();</b>
<b class="fc">&nbsp;        scrollPane.setBounds(13, 10, 400, 300);</b>
<b class="fc">&nbsp;        scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);</b>
<b class="fc">&nbsp;        messageDisplay.setEditable(false);</b>
<b class="fc">&nbsp;        messageDisplay.setBorder(BorderFactory.createLineBorder(Color.GRAY));</b>
<b class="fc">&nbsp;        messageDisplay.setLineWrap(true);</b>
<b class="fc">&nbsp;        messageDisplay.setWrapStyleWord(true);</b>
<b class="fc">&nbsp;        gbc.gridx = 0;</b>
<b class="fc">&nbsp;        gbc.gridy = 2; // Adjusted to be below the messageLabel</b>
<b class="fc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER; // Take remaining horizontal space</b>
<b class="fc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 10);</b>
<b class="fc">&nbsp;        scrollPane.setViewportView(messageDisplay);</b>
<b class="fc">&nbsp;        add(scrollPane, gbc);</b>
&nbsp;
&nbsp;// Message Input
<b class="fc">&nbsp;        messageInput.setPreferredSize(new Dimension(400, 50));</b>
<b class="fc">&nbsp;        messageInput.setBorder(BorderFactory.createLineBorder(Color.GRAY));</b>
<b class="fc">&nbsp;        gbc.gridx = 0;</b>
<b class="fc">&nbsp;        gbc.gridy++;</b>
<b class="fc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER; // Span across all columns</b>
<b class="fc">&nbsp;        gbc.insets = new Insets(5, 10, 5, 10);</b>
<b class="fc">&nbsp;        add(messageInput, gbc);</b>
&nbsp;
&nbsp;// Buttons
<b class="fc">&nbsp;        JPanel buttons = new JPanel();</b>
<b class="fc">&nbsp;        buttons.setLayout(new FlowLayout(FlowLayout.CENTER, 10, 0));</b>
<b class="fc">&nbsp;        this.getWeather = new JButton(ChatRoomViewModel.GET_WEATHER_BUTTON_LABEL);</b>
<b class="fc">&nbsp;        buttons.add(getWeather);</b>
<b class="fc">&nbsp;        this.send = new JButton(ChatRoomViewModel.SEND_MESSAGE_BUTTON_LABEL);</b>
<b class="fc">&nbsp;        buttons.add(send);</b>
<b class="fc">&nbsp;        this.getJoke = new JButton(chatRoomViewModel.GET_JOKE_BUTTON_LABEL);</b>
<b class="fc">&nbsp;        buttons.add(getJoke);</b>
<b class="fc">&nbsp;        this.logOut = new JButton(chatRoomViewModel.LOG_OUT_BUTTON_LABEL);</b>
<b class="fc">&nbsp;        buttons.add(logOut);</b>
<b class="fc">&nbsp;        gbc.gridx = 0;</b>
<b class="fc">&nbsp;        gbc.gridy++;</b>
<b class="fc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER; // Span across all columns</b>
<b class="fc">&nbsp;        gbc.insets = new Insets(5, 5, 20, 10);</b>
<b class="fc">&nbsp;        add(buttons, gbc);</b>
&nbsp;
<b class="fc">&nbsp;        customizeComponents();</b>
&nbsp;        // if the user clicks the close button on the frame, the user will autonatically log out
<b class="fc">&nbsp;        chatRoomViewModel.getCurrentframe().addWindowListener(new java.awt.event.WindowAdapter() {</b>
&nbsp;            @Override
&nbsp;            public void windowClosing(java.awt.event.WindowEvent windowEvent) {
<b class="nc">&nbsp;                ChatRoomState currentState = chatRoomViewModel.getState();</b>
<b class="nc">&nbsp;                int JOP = JOptionPane.showConfirmDialog(null, &quot;Are you sure you want to log out?&quot;, &quot;Log out&quot;, JOptionPane.YES_NO_OPTION);</b>
<b class="nc">&nbsp;                if (JOP == JOptionPane.YES_OPTION){</b>
<b class="nc">&nbsp;                    logOutController.execute(currentState.getUsername());</b>
<b class="nc">&nbsp;                    JFrame currentFrame = chatRoomViewModel.getCurrentframe();</b>
<b class="nc">&nbsp;                    currentFrame.dispose();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="fc">&nbsp;        logOut.addActionListener(</b>
&nbsp;                // This creates an anonymous subclass of ActionListener and instantiates it.
<b class="fc">&nbsp;                new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
<b class="fc">&nbsp;                        if (e.getSource().equals(logOut)) {</b>
<b class="fc">&nbsp;                            ChatRoomState currentState = chatRoomViewModel.getState();</b>
<b class="fc">&nbsp;                            int JOP = JOptionPane.showConfirmDialog(null, &quot;Are you sure you want to log out?&quot;, &quot;Log out&quot;, JOptionPane.YES_NO_OPTION);</b>
<b class="fc">&nbsp;                            if (JOP == JOptionPane.YES_OPTION){</b>
<b class="fc">&nbsp;                                logOutController.execute(currentState.getUsername());</b>
<b class="fc">&nbsp;                                JFrame currentFrame = chatRoomViewModel.getCurrentframe();</b>
<b class="fc">&nbsp;                                currentFrame.dispose();</b>
&nbsp;                            }
&nbsp;
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;        );
<b class="fc">&nbsp;        getWeather.addActionListener(</b>
&nbsp;                // This creates an anonymous subclass of ActionListener and instantiates it.
<b class="fc">&nbsp;                new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                        if (e.getSource().equals(getWeather)) {</b>
&nbsp;                            try {
<b class="nc">&nbsp;                                showWeatherController.execute();</b>
<b class="nc">&nbsp;                            } catch (IOException ex) {</b>
<b class="nc">&nbsp;                                throw new RuntimeException(ex);</b>
<b class="nc">&nbsp;                            }</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;        );
&nbsp;
<b class="fc">&nbsp;        send.addActionListener(</b>
&nbsp;                // This creates an anonymous subclass of ActionListener and instantiates it.
<b class="fc">&nbsp;                new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
<b class="fc">&nbsp;                        if (e.getSource().equals(send)) {</b>
<b class="fc">&nbsp;                            ChatRoomState currentState = chatRoomViewModel.getState();</b>
<b class="fc">&nbsp;                            String currentMessage = messageInput.getText();</b>
<b class="fc">&nbsp;                            if (!Objects.equals(currentMessage, &quot;&quot;)) {</b>
<b class="fc">&nbsp;                                LocalDateTime timestamp = LocalDateTime.now();</b>
&nbsp;                                try {
<b class="fc">&nbsp;                                    sendMessageController.execute(currentState.getUsername(), currentState.getSenderId(), currentMessage, timestamp, currentState.getChatRoomId());</b>
<b class="nc">&nbsp;                                } catch (IOException ex) {</b>
<b class="nc">&nbsp;                                    throw new RuntimeException(ex);</b>
<b class="fc">&nbsp;                                }</b>
&nbsp;//                                List&lt;String&gt; messages = currentState.getMessageHistory();
&nbsp;//                                messageDisplay.setText(null);
&nbsp;//                                for (String message : messages) {
&nbsp;//                                    messageDisplay.append(message + &quot;\n&quot;);
&nbsp;//                                }
<b class="fc">&nbsp;                                messageInput.setText(&quot;&quot;);</b>
<b class="fc">&nbsp;                            } else {</b>
<b class="nc">&nbsp;                                JOptionPane.showMessageDialog(ChatRoomView.this, &quot;The message is empty.&quot;);</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;        );
&nbsp;
<b class="fc">&nbsp;        getJoke.addActionListener(</b>
&nbsp;                // This creates an anonymous subclass of ActionListener and instantiates it.
<b class="fc">&nbsp;                new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                        if (e.getSource().equals(getJoke)) {</b>
&nbsp;                            try {
<b class="nc">&nbsp;                                showJokeController.execute();</b>
<b class="nc">&nbsp;                            } catch (IOException ep) {</b>
<b class="nc">&nbsp;                                throw new RuntimeException(ep);</b>
<b class="nc">&nbsp;                            }</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;        );
&nbsp;
<b class="fc">&nbsp;        Timer timer = new Timer(10, new ActionListener() {</b>
&nbsp;            @Override
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="fc">&nbsp;                int currentRows = messageDisplay.getLineCount();</b>
&nbsp;//                System.out.println(currentRows);
<b class="fc">&nbsp;                refreshingMessageController.execute();</b>
<b class="fc">&nbsp;                ChatRoomState currentState = chatRoomViewModel.getState();</b>
<b class="fc">&nbsp;                List&lt;String&gt; messages = currentState.getMessageHistory();</b>
&nbsp;//                System.out.println(messages.size() + 1);
<b class="fc">&nbsp;                if (currentRows != messages.size() + 1) {</b>
<b class="fc">&nbsp;                    messageDisplay.setText(null);</b>
<b class="fc">&nbsp;                    for (String message : messages) {</b>
<b class="fc">&nbsp;                        messageDisplay.append(message + &quot;\n&quot;);</b>
<b class="fc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="fc">&nbsp;        timer.start();</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    }
&nbsp;    private void customizeComponents() {
&nbsp;        // customize components
&nbsp;        // more beautiful buttons in organized format
<b class="fc">&nbsp;        send.setBackground(new Color(81, 204, 16));</b>
<b class="fc">&nbsp;        send.setForeground(Color.WHITE);</b>
<b class="fc">&nbsp;        send.setFocusPainted(false);</b>
<b class="fc">&nbsp;        send.setFont(new Font(&quot;Tahoma&quot;, Font.BOLD, 12));</b>
&nbsp;
<b class="fc">&nbsp;        getWeather.setBackground(new Color(30, 144, 255));</b>
<b class="fc">&nbsp;        getWeather.setForeground(Color.WHITE);</b>
<b class="fc">&nbsp;        getWeather.setFocusPainted(false);</b>
<b class="fc">&nbsp;        getWeather.setFont(new Font(&quot;Tahoma&quot;, Font.BOLD, 12));</b>
&nbsp;
<b class="fc">&nbsp;        logOut.setBackground(new Color(236, 180, 60, 255));</b>
<b class="fc">&nbsp;        logOut.setForeground(Color.WHITE);</b>
<b class="fc">&nbsp;        logOut.setFocusPainted(false);</b>
<b class="fc">&nbsp;        logOut.setFont(new Font(&quot;Tahoma&quot;, Font.BOLD, 12));</b>
&nbsp;
<b class="fc">&nbsp;        getJoke.setBackground(new Color(30, 144, 255));</b>
<b class="fc">&nbsp;        getJoke.setForeground(Color.WHITE);</b>
<b class="fc">&nbsp;        getJoke.setFocusPainted(false);</b>
<b class="fc">&nbsp;        getJoke.setFont(new Font(&quot;Tahoma&quot;, Font.BOLD, 12));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    public void actionPerformed(ActionEvent e) {
&nbsp;
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public void propertyChange(PropertyChangeEvent evt) {
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public JTextField getMessageInputField() {
<b class="nc">&nbsp;        return messageInput;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-12-02 17:40</div>
</div>
</body>
</html>
